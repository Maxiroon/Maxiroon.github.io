<!DOCTYPE html>
<html>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/CSS/style.css">
<script src="/JS/JSmain.js"></script>

<title>Blog - Maxiroon</title>
<link rel="icon" href="/media/favicon.ico">

<script src="/JS/template.js" defer></script>
<div id="nav"></div>

<head>
  <meta charset="UTF-8">
</head>
<body>
  <center>
  <h1 style="font-size: 60px;">Maxiroon's Blog</h1>
  <div class="cards-grid" id="blogGrid">
    <!-- Blog Entries go here -->
  </div></center>

<script>
async function loadPosts() {
  const grid = document.getElementById("blogGrid");

  // helper to format date locally üíñ
  function formatDate(dateStr) {
    if (!dateStr || dateStr === "Unknown") return "Unknown";
    const [year, month, day] = dateStr.split("-").map(Number);
    const d = new Date(2000 + year % 100, month - 1, day); // ensure 20YY
    return d.toLocaleDateString("en-US", {
      day: "2-digit",
      month: "short",
      year: "numeric"
    });
  }

  // fetch list of posts ‚ú®
  const res = await fetch("/blog/posts.json");
  let posts = await res.json();

  // sort newest first üåπ
  posts.sort((a, b) => {
    const [aY, aM, aD] = a.replace(".html","").split(".").map(Number);
    const [bY, bM, bD] = b.replace(".html","").split(".").map(Number);
    const dateA = new Date(2000 + aY, aM - 1, aD);
    const dateB = new Date(2000 + bY, bM - 1, bD);
    return dateB - dateA; // newest first
  });

  for (const file of posts) {
    try {
      const htmlRes = await fetch(`/blog/${file}`);
      const html = await htmlRes.text();

      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      // grab H1 title üíï
      const title = doc.querySelector("h1")?.textContent.trim() || "Untitled";

      // grab metadata üåπ
      const postDateRaw = doc.querySelector("meta[name='post-date']")?.content || file.split(".").slice(0,3).join("-"); // fallback to filename
      const updateDateRaw = doc.querySelector("meta[name='update-date']")?.content || "Unknown";
      const coverImage = doc.querySelector("meta[name='cover-image']")?.content || "";

      const postDate = formatDate(postDateRaw);
      const updateDate = formatDate(updateDateRaw);

      // grab first 20 words of first <p> üíå
      let firstParagraph = doc.querySelector("p")?.textContent || "";
      let preview = firstParagraph.split(/\s+/).slice(0, 20).join(" ");
      if (firstParagraph.split(/\s+/).length > 20) preview += "...";

      // build card ‚ú®
      const card = document.createElement("div");
      card.classList.add("cards-card");

      const imageHTML = coverImage
        ? `<img class="cards-image" src="${coverImage}" alt="${title}">`
        : `<div class="cards-image">NO IMAGE</div>`;

      card.innerHTML = `
        ${imageHTML}
        <h1>${title}</h1>
        <h3><small>Published: ${postDate} ‚óè Updated: ${updateDate}</small></h3>
        <hr>
        <p class="preview">${preview}</p>
        <a href="/blog/${file}">Read More</a>
      `;

      grid.appendChild(card);

    } catch (err) {
      console.error("Error loading post:", file, err);
    }
  }
}

loadPosts();
</script>

</body>

<footer>
    <br>
    <center>
        <div id="footer"></div>
    </center>
    <br>
</footer>

</html>
